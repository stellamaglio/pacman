<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pac-Man Mobile</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      touch-action: none;
    }
    canvas {
      background: #000;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <canvas id="game" width="320" height="320"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const size = 32;
    const map = [
      "####################",
      "#........##........#",
      "#.####.#.##.#.####.#",
      "#o#  #.#.##.#.#  #o#",
      "#.####.#.##.#.####.#",
      "#..................#",
      "#.####.######.####.#",
      "#..................#",
      "####################"
    ];
    const rows = map.length;
    const cols = map[0].length;
    let pacman = { x: 1, y: 1, dx: 0, dy: 0 };
    let ghosts = [
      { x: 18, y: 1, dx: 0, dy: 1, color: 'red' },
      { x: 18, y: 7, dx: -1, dy: 0, color: 'pink' }
    ];

    function drawTile(x, y, c) {
      if (c === "#") {
        ctx.fillStyle = "#111";
        ctx.fillRect(x * size, y * size, size, size);
      } else if (c === ".") {
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(x * size + size/2, y * size + size/2, 4, 0, Math.PI * 2);
        ctx.fill();
      } else if (c === "o") {
        ctx.fillStyle = "orange";
        ctx.beginPath();
        ctx.arc(x * size + size/2, y * size + size/2, 8, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          drawTile(x, y, map[y][x]);
        }
      }

      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(pacman.x * size + size/2, pacman.y * size + size/2, size/2 - 4, 0.25 * Math.PI, 1.75 * Math.PI);
      ctx.lineTo(pacman.x * size + size/2, pacman.y * size + size/2);
      ctx.fill();

      for (const ghost of ghosts) {
        ctx.fillStyle = ghost.color;
        ctx.beginPath();
        ctx.arc(ghost.x * size + size/2, ghost.y * size + size/2, size/2 - 4, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function moveEntity(entity) {
      const newX = entity.x + entity.dx;
      const newY = entity.y + entity.dy;
      if (map[newY][newX] !== "#") {
        entity.x = newX;
        entity.y = newY;
      }
    }

    function update() {
      moveEntity(pacman);
      for (const ghost of ghosts) {
        if (Math.random() < 0.2) {
          let dirs = [
            { dx: 0, dy: -1 }, { dx: 0, dy: 1 },
            { dx: -1, dy: 0 }, { dx: 1, dy: 0 }
          ];
          let d = dirs[Math.floor(Math.random() * dirs.length)];
          ghost.dx = d.dx;
          ghost.dy = d.dy;
        }
        moveEntity(ghost);
        if (ghost.x === pacman.x && ghost.y === pacman.y) {
          alert("Hai perso!");
          reset();
        }
      }
      const cell = map[pacman.y][pacman.x];
      if (cell === ".") map[pacman.y] = replaceChar(map[pacman.y], pacman.x, " ");
      if (cell === "o") map[pacman.y] = replaceChar(map[pacman.y], pacman.x, " ");
    }

    function replaceChar(str, index, replacement) {
      return str.substring(0, index) + replacement + str.substring(index + 1);
    }

    function gameLoop() {
      update();
      draw();
    }

    setInterval(gameLoop, 200);

    let startX = 0, startY = 0;
    canvas.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });
    canvas.addEventListener("touchend", e => {
      const dx = e.changedTouches[0].clientX - startX;
      const dy = e.changedTouches[0].clientY - startY;
      if (Math.abs(dx) > Math.abs(dy)) {
        pacman.dx = dx > 0 ? 1 : -1;
        pacman.dy = 0;
      } else {
        pacman.dy = dy > 0 ? 1 : -1;
        pacman.dx = 0;
      }
    });

    function reset() {
      pacman = { x: 1, y: 1, dx: 0, dy: 0 };
      ghosts = [
        { x: 18, y: 1, dx: 0, dy: 1, color: 'red' },
        { x: 18, y: 7, dx: -1, dy: 0, color: 'pink' }
      ];
    }
  </script>
</body>
</html>
